# Task 1 - Install dotnet pre-requisites

- [dotnet 7.0](https://learn.microsoft.com/en-us/dotnet/core/install/linux-ubuntu#2004)

```
wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
rm packages-microsoft-prod.deb
sudo apt-get update
sudo apt-get install -y aspnetcore-runtime-7.0
```

# Task 2 - Containerize the application

## Download the sample app

```
git clone https://github.com/dotnet/dotnet-docker
```

## Execute the .NET application

```
cd ~/dotnet-docker/samples/aspnetapp/aspnetapp
dotnet run
```

Web App is listening on http://localhost:5011
Press Ctrl+C at the command prompt to stop the app.

```
Building...
warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[35]
      No XML encryptor configured. Key {7f537284-4d68-438e-ba7c-bdd5fa14835d} may be persisted to storage in unencrypted form.
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5011
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
```

## Review the project configuration

The project is using .net 7.0

vi ~/dotnet-docker/samples/aspnetapp/aspnetapp/aspnetapp.csproj
```
<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>net7.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UserSecretsId>57393389627611478466</UserSecretsId>
  </PropertyGroup>

</Project>
```

## Review the Dockerfile build instructions

- [dotnet restore](https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-restore)
- [dotnet publish](https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-publish)
- [Docker Entrypoint](https://docs.docker.com/engine/reference/builder/)

vi ~/dotnet-docker/samples/aspnetapp

```Dockerfile
# https://hub.docker.com/_/microsoft-dotnet
FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build  #The sample uses this image for building the app. The image contains the .NET SDK 
WORKDIR /source

# copy csproj and restore as distinct layers
COPY aspnetapp/*.csproj .
# Restores the dependencies and tools of a project.
RUN dotnet restore --use-current-runtime

# copy everything else and build app
COPY aspnetapp/. .
# Publishes the application and its dependencies to a folder for deployment to a hosting system
RUN dotnet publish -c Release -o /app --use-current-runtime --self-contained false --no-restore #

# final stage/image
FROM mcr.microsoft.com/dotnet/aspnet:7.0        #The sample uses this image for running the app. The image contains the ASP.NET Core runtime and librarie
WORKDIR /app
COPY --from=build /app .
ENTRYPOINT ["dotnet", "aspnetapp.dll"]          #An ENTRYPOINT allows you to configure a container that will run as an executable
```

## Build the images in the local registry

Build from Dockerfile

```
cd ~/dotnet-docker/samples/aspnetapp
docker build -t aspnetapp:1.0 .
docker images
```

## Run the container

```
docker run -d -p 8080:80 --name myaspnetapp aspnetapp:1.0    #Run and expose service port
curl http://localhost:8080/                               #Access exposed port
docker ps                                                 #show running container
docker stop myhello                                       #stop by name
docker ps -a                                              #show all container
```
