## Task 1 - Docker Run

- [Docker Overview](https://docs.docker.com/get-started/overview/)
- [Docker Carlos Alexei](https://github.com/carlosalexei/aks-workshop/blob/main/content/labs/00.docker.md)

### Docker commands

```Dockerfile
docker pull nginx                                 #Download images
docker images nginx                               #Local images
docker run -d -p 8080:80 --name mynginx nginx     #Run "mynginx" container
docker ps -a | grep nginx                         #Show container (running & stopped)
curl http://localhost:8080                        #Test web application
docker exec -it mynginx bash                      #Interact with container,execute bash command : ls -la
docker stop mynginx                               #Stop "mynginx" container
docker rm mynginx                                 #Remove "mynginx" container
docker rm $(docker ps -a -q)                      #Remove all your containers
docker rmi nginx                                  #Remove "nginx" image
```

## Task 2 - Build & Containerize an application

- [Docker Get Started](https://docs.docker.com/get-started/)
- [How to Containerize an application(Carlos Alexei)](https://github.com/carlosalexei/aks-workshop/blob/main/content/labs/00.docker.md)

### Requisites

- [donet 6.0](https://learn.microsoft.com/en-us/dotnet/core/install/linux-ubuntu#2004)

### .NET 6.0

Add the Microsoft package signing key to your list of trusted keys and add the package repository.

```Shell
wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
rm packages-microsoft-prod.deb
```

Install the SDK

```Shell
sudo apt-get update && sudo apt-get install -y dotnet-sdk-6.0
```
### Modify the application

```Shell
git clone https://github.com/carlosalexei/demoapps.git  #clone the app
cd demoapps/HelloWorld/Views/Home/                      #cd to app directory
vi Index.cshtml                                         #modify something
```
```html
@{
    ViewData["Title"] = "Home Page";
}
<div class="text-center">
    <h1 class="display-4">Hello World</h1>
    <p>Greetings from Avanade, I hope you are enjoying the session.</p>
    <p>Best regards, </br>xxxxx/p>

    <p>yyyy</p>
</div>
```

### Review the project configuration

```Shell
cd ~/demoapps/HelloWorld                                #Explore app properties
vi HelloWorld.csproj                                    #Project is dotnet 6.0
```
```HTML
<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
  </PropertyGroup>

</Project>
```

### Review the Build instructions

~/demoapps/Helloworld/Dockerfile

```Dockerfile
FROM mcr.microsoft.com/dotnet/sdk:6.0 as DevEnv         #Retrieve base image that includes sdk
WORKDIR /app                                            #Create a folder
COPY *.csproj ./                                        #Copy copy c# project files
RUN dotnet restore                                      #Restore dotnet libraries for the project
COPY . ./                                               #Copy all application files
RUN dotnet publish -c Release -o /app/out               #Compile project and create production binaries
FROM mcr.microsoft.com/dotnet/aspnet:6.0                #Download another images with aspnet runtime
COPY --from=DevEnv /app/out .                           #Copy from the first image (DevEnv) only the binaries runtime (no libraries copied)
ENTRYPOINT [ "dotnet", "HelloWorld.dll" ]               #Define the process to be executed in the container
```

- DevEnv  image is for Develop Envirnment to compile and build , it has a big footprint (737 MB)
- AspNet is lighter because only and include only the binaries from DenvEnv (not sdk)

### Docker Run

```Dockerfile
docker run -d -p 8080:80 helloworld:1.0
curl http://localhost:8080/
docker ps
docker stop youthful_tharp
```
### Build the images

```Dockerfile
docker build -t helloworld:1.0 .
docker images
```

## Publish to some registry

- [Publish to registry](https://dsri.maastrichtuniversity.nl/docs/guide-publish-image/)

### Docker publish to Docker Container Registry (docker.io)

```Dockerfile
docker tag helloworld:1.0 yeffa/helloworld:1.0      #tag the local image with the docker account
docker images                                       #images
docker login                                        #login username/password
docker push yeffa/helloworld:1.0                    #The push implicit to the docker registry [docker.io/yeffa]
docker push docker.io/yeffa/helloworld:1.0          #The push explicit the registry dockerhub.com
docker logout                                       #logout
docker pull yeffa/helloworld:1.0                    #Docker users will use docker pull
```

Explore published images at https://hub.docker.com/

### Publish to GitHub Container Registry (ghcr.io)

```Dockerfile
docker tag helloworld:1.0 yeffa/helloworld:1.0      #tag the local image with the docker account
docker images                                       #images
docker login                                        #login username/password
docker push yeffa/helloworld:1.0                    #The push implicit to the docker registry [docker.io/yeffa]
docker push docker.io/yeffa/helloworld:1.0          #The push explicit the registry dockerhub.com
docker logout                                       #logout
docker pull yeffa/helloworld:1.0                    #Docker users will use docker pull
```

Explore images at https://hub.docker.com/

### Cleanup

```Dockerfile
docker images
docker rm $(docker ps -a -q)    #remove all container
docker rmi helloworld:1.0
docker rmi yeffa/helloworld:1.0
docker rmi mcr.microsoft.com/dotnet/aspnet:6.0
docker rmi mcr.microsoft.com/dotnet/sdk:6.0
docker rmi 4844f37e89f7 -f
```

